---
title: <span style="color:red;">Building a house with<br />Advanced Normalization Tools (*ANTs*)</span>
author: Brian B. Avants (<span style="color:blue;">PENN</span>) and <br />Nicholas J. Tustison (<span style="color:orange;">UVA</span>)
bibliography: REFERENCES.bib
logo:    logo.jpg
output:
  pdf_document:
    toc: true
    highlight: zenburn
  beamer_presentation:
    toc: true
    fig_width: 7
    fig_height: 6
  html_document:
    toc: true
    theme: readable
  revealjs_presentation:
    pandoc_args: [ "--slide-level", "2" ]
    incremental: true
    widescreen: true
    smaller: false
    theme: night
    transition: fade
    highlight: zenburn
    center: true
    self_contained: false
  ioslides_presentation:
    css: atk.css
    incremental: false
    widescreen: true
    smaller: false
    fig_width: 5
---

```{r global options, include=FALSE}
library(rmarkdown)
library(knitr)
figpath<-'figures/'
opts_chunk$set(fig.width=9, fig.height=6, fig.path=figpath,
               warning=FALSE, message=FALSE)
```


## 

<div align="center"><img src="./figures/brian_and_edie_sedgwick.jpg" frameborder="0"></img></div>

This talk is online at [http://stnava.github.io/ANTs2015/](http://stnava.github.io/ANTs2015/) with colored [links](http://stnava.github.io/ANTs2015/) meant to be clicked for more information.

# Background

## Founding developers

<div align="center"><img width="1800" src="./figures/bant2.png" frameborder="0"></img></div>

BBA & NT

## Long-term collaborators

![](./figures/antscollab.jpg)


$+$ [neurodebian](http://neuro.debian.net/pkgs/ants.html), [slicer](http://www.slicer.org/), [brainsfit](https://github.com/BRAINSia/BRAINSTools), [nipype](http://nipy.sourceforge.net/nipype/), [itk](http://www.itk.org) and more ...


## 

![](./figures/lion.png)

a pride: common way of doing things

## Definitions

* Registration $=$ estimate an "optimal" geometric mapping between image pairs or image sets (e.g. Affine)

* Similarity $=$ a function relating one image to another, given a transformation (e.g. mutual information)

* <span style="color:grey;">
Diffeomorphisms $=$ differentiable map with differentiable inverse (e.g. "silly putty", viscous fluid)  </span>

* Segmentation $=$ labeling tissue or anatomy in images, usually automated (e.g. K-means)

* <span style="color:grey;"> Multivariate $=$ using many voxels or measurements at once (e.g. PCA, $p >> n$ ridge regression)</span>

* Multiple modality $=$ using many modalities at once (e.g. DTI and T1 and BOLD)

* MALF: multi-atlas label fusion - using anatomical dictionaries to label new data

* Solutions to challenging statistical image processing problems usually need elements from each of the above 


## Image mapping & perception: 1878

![](./figures/galton.png)

* Francis Galton: Can we see criminality in the face?

* (maybe he should have used ANTs?)


## Initial scope

![](./figures/ants_initial_scope.png)

... just do a better registration (tell story) ...

## ANTs Lineage 

![](./figures/lineage.jpg)

References: @Horn1981, @Gee1993, @Grenander1993, @Thompson2001, @Miller2002, @Shen2002, @Arnold2014, @Thirion1998, @Rueckert1999, @Fischl2012, @Ashburner2012

## Diffeomorphisms

<div align="center"><img width="1433" src="./figures/sillyputty.png" frameborder="0"></img></div>

plausible physical modeling of large, invertible deformations

"differentiable map with differentiable inverse"

## Fine-grained and flexible maps
![](./figures/highresdiffeos.jpg)

... to correct a misconception about diffeomorphisms ...


## General purpose library for multivariate image registration, segmentation & statistical analysis tools

* 170,000+ lines of C++, 6$+$ years of work, 15+ collaborators. 

* Generic mathematical methods that are tunable for 
application specific domains:  no-free lunch

* Deep testing on multiple platforms ... osx, linux, windows.

* Several "wins" in public knock-abouts ( [Klein 2009](http://www.ncbi.nlm.nih.gov/pubmed/19195496), [Murphy 2011](http://www.ncbi.nlm.nih.gov/pubmed/21632295), [SATA 2012 and 2013](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3837555/), [BRATS 2013](http://martinos.org/qtim/miccai2013/proc_brats_2013.pdf), others ) 

```
    An algorithm must use prior knowledge about a problem 
    to do well on that problem 
```

## ANTs: Beyond Registration

![](./figures/antscapabilities.jpg)

[Atropos](http://www.ncbi.nlm.nih.gov/pubmed/?term=atropos+tustison) segmentation, [N4 inhomogeneity correction](http://www.ncbi.nlm.nih.gov/pubmed/?term=N4+tustison), [Eigenanatomy](http://www.ncbi.nlm.nih.gov/pubmed/?term=eigenanatomy+avants), [SCCAN](http://www.ncbi.nlm.nih.gov/pubmed/?term=sparse+canonical+avants), [Prior-constrained PCA](http://www.ncbi.nlm.nih.gov/pubmed/24852460), and [atlas-based label fusion](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC4009425/) and [MALF](http://www.ncbi.nlm.nih.gov/pubmed/21237273) (powerful expert systems for segmentation)

```

## On documentation

![](figures/handsaw.jpg)

simple and nearly self-explanatory

## On documentation

![](figures/Chainsaw.jpg)

documentation is important

## On documentation

![](figures/blindmen.jpg)

... developers can be blind to doc deficiencies

while users are blind to what we provide!

# Optimal Templates

## "Optimal" templates (?)

* unbiased wrt measurement space 

* space is non-linear: reference matters

* encodes prior information: still just averages (usually)

* concept extends across modalities, anatomy, temporality, etc

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.060.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.061.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.062.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.063.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.064.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.065.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.066.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.067.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.068.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.069.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.070.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.071.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.072.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.073.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.074.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.075.jpg)

## Faces, brains, whatever ... 

![](templates/figures/WashUJan2011.076.jpg)

see [ANTs site](stnava.github.io/ANTs) and [ANTs Documentation page](stnava.github.io/ANTsDoc)

## Templates from ANTs Colleagues ( not us )

![](templates/figures/templates_ants_colleagues.png)
## longitudinal

work

# Cortical thickness with lesions

## antsCorticalThickness.sh is adaptable!

1. Register subject (or single subject template) to normal template.

2. Transform lesion mask to normal template.

3. Create additional "lesion" prior, i.e. ```SmoothImage 3 ${lesionMask} 1 ${lesionPrior} 1```.

4.  Subtract out lesion prior from all other priors and keep values $\in [0,1]$.

## Modified template spatial priors

![](lesions/figures/lesionPrior.png)

## antsCorticalThickness.sh using lesion prior

![](lesions/figures/lesionSegmentation.png)

Only change to the command call is an additional '-c WM[7]' which means "combine
the 7<sup>th</sup> prior, i.e. lesion, to the white matter for cortical thickness calculation."


# References

